{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Tab = void 0;\n\nvar eventManager_1 = require(\"./eventManager\");\n\nvar EventMap = {\n  focus: 'focus',\n  blur: 'blur',\n  beforeunload: 'unload',\n  DOMContentLoaded: 'load',\n  visibilitychange: 'visibilityChange'\n};\n\nvar Tab =\n/** @class */\nfunction () {\n  function Tab(id, isNew, urlSanitizer) {\n    this.eventManager = new eventManager_1.SynchronousEventManager();\n    this.id = id;\n    this.isNew = isNew;\n    this.urlSanitizer = urlSanitizer;\n    this.initialize();\n  }\n\n  Tab.prototype.initialize = function () {\n    var _this = this;\n\n    var listener = function (event) {\n      _this.emit(EventMap[event.type], new CustomEvent(EventMap[event.type], {\n        detail: {\n          tab: _this\n        }\n      }));\n    };\n\n    window.addEventListener('focus', listener, true);\n    window.addEventListener('blur', listener, true);\n    window.addEventListener('beforeunload', listener, true);\n    window.addEventListener('DOMContentLoaded', listener, true);\n    document.addEventListener('visibilitychange', function () {\n      _this.emit('visibilityChange', new CustomEvent('visibilityChange', {\n        detail: {\n          tab: _this,\n          visible: _this.isVisible\n        }\n      }));\n    }, true);\n    Tab.addUrlChangeListener(function (url) {\n      _this.emit('urlChange', new CustomEvent('urlChange', {\n        detail: {\n          tab: _this,\n          url: _this.sanitizeUrl(url)\n        }\n      }));\n    });\n  };\n\n  Object.defineProperty(Tab.prototype, \"url\", {\n    get: function () {\n      return this.sanitizeUrl(window.location.href);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tab.prototype, \"title\", {\n    get: function () {\n      return document.title;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tab.prototype, \"referrer\", {\n    get: function () {\n      return document.referrer === '' ? '' : this.sanitizeUrl(document.referrer);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tab.prototype, \"isVisible\", {\n    get: function () {\n      return document.visibilityState === 'visible';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tab.prototype, \"document\", {\n    get: function () {\n      return document;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Tab.prototype.addListener = function (type, listener) {\n    this.eventManager.addListener(type, listener);\n  };\n\n  Tab.prototype.removeListener = function (type, listener) {\n    this.eventManager.removeListener(type, listener);\n  };\n\n  Tab.prototype.sanitizeUrl = function (url) {\n    var normalized = window.encodeURI(window.decodeURI(url));\n\n    if (this.urlSanitizer !== undefined) {\n      return this.urlSanitizer(normalized).toString();\n    }\n\n    return normalized;\n  };\n\n  Tab.prototype.emit = function (type, event) {\n    this.eventManager.dispatch(type, event);\n  };\n\n  Tab.addUrlChangeListener = function (listener) {\n    var url = window.location.href;\n\n    var updateUrl = function () {\n      var currentUrl = window.location.href;\n\n      if (url !== currentUrl) {\n        listener(currentUrl);\n        url = currentUrl;\n      }\n    };\n\n    var pushState = window.history.pushState;\n\n    window.history.pushState = function interceptPushState() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var result = pushState.apply(window.history, args);\n      updateUrl();\n      return result;\n    };\n\n    var replaceState = window.history.replaceState;\n\n    window.history.replaceState = function interceptReplaceState() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var result = replaceState.apply(window.history, args);\n      updateUrl();\n      return result;\n    };\n\n    window.addEventListener('popstate', updateUrl, true);\n  };\n\n  return Tab;\n}();\n\nexports.Tab = Tab;","map":{"version":3,"names":["Object","defineProperty","exports","value","Tab","eventManager_1","require","EventMap","focus","blur","beforeunload","DOMContentLoaded","visibilitychange","id","isNew","urlSanitizer","eventManager","SynchronousEventManager","initialize","prototype","_this","listener","event","emit","type","CustomEvent","detail","tab","window","addEventListener","document","visible","isVisible","addUrlChangeListener","url","sanitizeUrl","get","location","href","enumerable","configurable","title","referrer","visibilityState","addListener","removeListener","normalized","encodeURI","decodeURI","undefined","toString","dispatch","updateUrl","currentUrl","pushState","history","interceptPushState","args","_i","arguments","length","result","apply","replaceState","interceptReplaceState"],"sources":["C:/Users/User/croct/node_modules/@croct/sdk/tab.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Tab = void 0;\nvar eventManager_1 = require(\"./eventManager\");\nvar EventMap = {\n    focus: 'focus',\n    blur: 'blur',\n    beforeunload: 'unload',\n    DOMContentLoaded: 'load',\n    visibilitychange: 'visibilityChange',\n};\nvar Tab = /** @class */ (function () {\n    function Tab(id, isNew, urlSanitizer) {\n        this.eventManager = new eventManager_1.SynchronousEventManager();\n        this.id = id;\n        this.isNew = isNew;\n        this.urlSanitizer = urlSanitizer;\n        this.initialize();\n    }\n    Tab.prototype.initialize = function () {\n        var _this = this;\n        var listener = function (event) {\n            _this.emit(EventMap[event.type], new CustomEvent(EventMap[event.type], { detail: { tab: _this } }));\n        };\n        window.addEventListener('focus', listener, true);\n        window.addEventListener('blur', listener, true);\n        window.addEventListener('beforeunload', listener, true);\n        window.addEventListener('DOMContentLoaded', listener, true);\n        document.addEventListener('visibilitychange', function () {\n            _this.emit('visibilityChange', new CustomEvent('visibilityChange', {\n                detail: {\n                    tab: _this,\n                    visible: _this.isVisible,\n                },\n            }));\n        }, true);\n        Tab.addUrlChangeListener(function (url) {\n            _this.emit('urlChange', new CustomEvent('urlChange', { detail: { tab: _this, url: _this.sanitizeUrl(url) } }));\n        });\n    };\n    Object.defineProperty(Tab.prototype, \"url\", {\n        get: function () {\n            return this.sanitizeUrl(window.location.href);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Tab.prototype, \"title\", {\n        get: function () {\n            return document.title;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Tab.prototype, \"referrer\", {\n        get: function () {\n            return document.referrer === '' ? '' : this.sanitizeUrl(document.referrer);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Tab.prototype, \"isVisible\", {\n        get: function () {\n            return document.visibilityState === 'visible';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Tab.prototype, \"document\", {\n        get: function () {\n            return document;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Tab.prototype.addListener = function (type, listener) {\n        this.eventManager.addListener(type, listener);\n    };\n    Tab.prototype.removeListener = function (type, listener) {\n        this.eventManager.removeListener(type, listener);\n    };\n    Tab.prototype.sanitizeUrl = function (url) {\n        var normalized = window.encodeURI(window.decodeURI(url));\n        if (this.urlSanitizer !== undefined) {\n            return this.urlSanitizer(normalized).toString();\n        }\n        return normalized;\n    };\n    Tab.prototype.emit = function (type, event) {\n        this.eventManager.dispatch(type, event);\n    };\n    Tab.addUrlChangeListener = function (listener) {\n        var url = window.location.href;\n        var updateUrl = function () {\n            var currentUrl = window.location.href;\n            if (url !== currentUrl) {\n                listener(currentUrl);\n                url = currentUrl;\n            }\n        };\n        var pushState = window.history.pushState;\n        window.history.pushState = function interceptPushState() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var result = pushState.apply(window.history, args);\n            updateUrl();\n            return result;\n        };\n        var replaceState = window.history.replaceState;\n        window.history.replaceState = function interceptReplaceState() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var result = replaceState.apply(window.history, args);\n            updateUrl();\n            return result;\n        };\n        window.addEventListener('popstate', updateUrl, true);\n    };\n    return Tab;\n}());\nexports.Tab = Tab;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}
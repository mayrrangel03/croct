{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TabContextFactory = exports.MinimalContextFactory = exports.EvaluatorFacade = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar schema_1 = require(\"../schema\");\n\nvar error_1 = require(\"../error\");\n\nfunction validate(options) {\n  if (typeof options !== 'object' || options === null) {\n    throw new Error('The options must be an object.');\n  }\n\n  try {\n    schema_1.optionsSchema.validate(options);\n  } catch (violation) {\n    throw new Error(\"Invalid options: \".concat((0, error_1.formatCause)(violation)));\n  }\n}\n\nvar EvaluatorFacade =\n/** @class */\nfunction () {\n  function EvaluatorFacade(evaluator, contextFactory) {\n    this.evaluator = evaluator;\n    this.contextFactory = contextFactory;\n  }\n\n  EvaluatorFacade.prototype.evaluate = function (expression, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (typeof expression !== 'string' || expression.length === 0) {\n      throw new Error('The expression must be a non-empty string.');\n    }\n\n    validate(options);\n    return this.evaluator.evaluate(expression, {\n      timeout: options.timeout,\n      context: this.contextFactory.createContext(options.attributes)\n    });\n  };\n\n  return EvaluatorFacade;\n}();\n\nexports.EvaluatorFacade = EvaluatorFacade;\n\nvar MinimalContextFactory =\n/** @class */\nfunction () {\n  function MinimalContextFactory() {}\n\n  MinimalContextFactory.prototype.createContext = function (attributes) {\n    if (attributes === undefined) {\n      return {};\n    }\n\n    return {\n      attributes: attributes\n    };\n  };\n\n  return MinimalContextFactory;\n}();\n\nexports.MinimalContextFactory = MinimalContextFactory;\n\nvar TabContextFactory =\n/** @class */\nfunction () {\n  function TabContextFactory(tab) {\n    this.tab = tab;\n  }\n\n  TabContextFactory.prototype.createContext = function (attributes) {\n    var url = new URL(this.tab.url);\n    var context = {};\n    var page = {\n      title: this.tab.title,\n      url: url.toString()\n    };\n    var referrer = this.tab.referrer;\n\n    if (referrer.length > 0) {\n      page.referrer = referrer;\n    }\n\n    context.page = page;\n    var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || null;\n\n    if (timezone !== null) {\n      context.timezone = timezone;\n    }\n\n    var campaign = TabContextFactory.createCampaign(url);\n\n    if (Object.keys(campaign).length > 0) {\n      context.campaign = campaign;\n    }\n\n    if (attributes !== undefined && Object.keys(attributes).length > 0) {\n      context.attributes = attributes;\n    }\n\n    return context;\n  };\n\n  TabContextFactory.createCampaign = function (url) {\n    var e_1, _a;\n\n    var campaign = {};\n\n    try {\n      for (var _b = tslib_1.__values(url.searchParams.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var _d = tslib_1.__read(_c.value, 2),\n            parameter = _d[0],\n            value = _d[1];\n\n        switch (parameter.toLowerCase()) {\n          case 'utm_campaign':\n            campaign.name = value;\n            break;\n\n          case 'utm_source':\n            campaign.source = value;\n            break;\n\n          case 'utm_term':\n            campaign.term = value;\n            break;\n\n          case 'utm_medium':\n            campaign.medium = value;\n            break;\n\n          case 'utm_content':\n            campaign.content = value;\n            break;\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    return campaign;\n  };\n\n  return TabContextFactory;\n}();\n\nexports.TabContextFactory = TabContextFactory;","map":{"version":3,"names":["Object","defineProperty","exports","value","TabContextFactory","MinimalContextFactory","EvaluatorFacade","tslib_1","require","schema_1","error_1","validate","options","Error","optionsSchema","violation","concat","formatCause","evaluator","contextFactory","prototype","evaluate","expression","length","timeout","context","createContext","attributes","undefined","tab","url","URL","page","title","toString","referrer","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","campaign","createCampaign","keys","e_1","_a","_b","__values","searchParams","entries","_c","next","done","_d","__read","parameter","toLowerCase","name","source","term","medium","content","e_1_1","error","return","call"],"sources":["C:/Users/User/croct/node_modules/@croct/sdk/facade/evaluatorFacade.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TabContextFactory = exports.MinimalContextFactory = exports.EvaluatorFacade = void 0;\nvar tslib_1 = require(\"tslib\");\nvar schema_1 = require(\"../schema\");\nvar error_1 = require(\"../error\");\nfunction validate(options) {\n    if (typeof options !== 'object' || options === null) {\n        throw new Error('The options must be an object.');\n    }\n    try {\n        schema_1.optionsSchema.validate(options);\n    }\n    catch (violation) {\n        throw new Error(\"Invalid options: \".concat((0, error_1.formatCause)(violation)));\n    }\n}\nvar EvaluatorFacade = /** @class */ (function () {\n    function EvaluatorFacade(evaluator, contextFactory) {\n        this.evaluator = evaluator;\n        this.contextFactory = contextFactory;\n    }\n    EvaluatorFacade.prototype.evaluate = function (expression, options) {\n        if (options === void 0) { options = {}; }\n        if (typeof expression !== 'string' || expression.length === 0) {\n            throw new Error('The expression must be a non-empty string.');\n        }\n        validate(options);\n        return this.evaluator.evaluate(expression, {\n            timeout: options.timeout,\n            context: this.contextFactory.createContext(options.attributes),\n        });\n    };\n    return EvaluatorFacade;\n}());\nexports.EvaluatorFacade = EvaluatorFacade;\nvar MinimalContextFactory = /** @class */ (function () {\n    function MinimalContextFactory() {\n    }\n    MinimalContextFactory.prototype.createContext = function (attributes) {\n        if (attributes === undefined) {\n            return {};\n        }\n        return { attributes: attributes };\n    };\n    return MinimalContextFactory;\n}());\nexports.MinimalContextFactory = MinimalContextFactory;\nvar TabContextFactory = /** @class */ (function () {\n    function TabContextFactory(tab) {\n        this.tab = tab;\n    }\n    TabContextFactory.prototype.createContext = function (attributes) {\n        var url = new URL(this.tab.url);\n        var context = {};\n        var page = {\n            title: this.tab.title,\n            url: url.toString(),\n        };\n        var referrer = this.tab.referrer;\n        if (referrer.length > 0) {\n            page.referrer = referrer;\n        }\n        context.page = page;\n        var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || null;\n        if (timezone !== null) {\n            context.timezone = timezone;\n        }\n        var campaign = TabContextFactory.createCampaign(url);\n        if (Object.keys(campaign).length > 0) {\n            context.campaign = campaign;\n        }\n        if (attributes !== undefined && Object.keys(attributes).length > 0) {\n            context.attributes = attributes;\n        }\n        return context;\n    };\n    TabContextFactory.createCampaign = function (url) {\n        var e_1, _a;\n        var campaign = {};\n        try {\n            for (var _b = tslib_1.__values(url.searchParams.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _d = tslib_1.__read(_c.value, 2), parameter = _d[0], value = _d[1];\n                switch (parameter.toLowerCase()) {\n                    case 'utm_campaign':\n                        campaign.name = value;\n                        break;\n                    case 'utm_source':\n                        campaign.source = value;\n                        break;\n                    case 'utm_term':\n                        campaign.term = value;\n                        break;\n                    case 'utm_medium':\n                        campaign.medium = value;\n                        break;\n                    case 'utm_content':\n                        campaign.content = value;\n                        break;\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return campaign;\n    };\n    return TabContextFactory;\n}());\nexports.TabContextFactory = TabContextFactory;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}
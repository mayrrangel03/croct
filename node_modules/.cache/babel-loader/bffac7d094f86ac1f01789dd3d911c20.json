{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PlaygroundPlugin = exports.factory = void 0;\n\nvar error_1 = require(\"@croct/sdk/error\");\n\nvar evaluatorFacade_1 = require(\"@croct/sdk/facade/evaluatorFacade\");\n\nvar constants_1 = require(\"./constants\");\n\nvar factory = function (_a) {\n  var sdk = _a.sdk,\n      options = _a.options;\n  return new PlaygroundPlugin({\n    sdkVersion: sdk.version,\n    appId: sdk.appId,\n    connectionId: options.connectionId,\n    tab: sdk.tab,\n    storage: sdk.getTabStorage(),\n    tokenProvider: sdk.tokenStore,\n    cidAssigner: sdk.cidAssigner,\n    contextFactory: new evaluatorFacade_1.TabContextFactory(sdk.tab),\n    eventSubscriber: sdk.eventManager,\n    logger: sdk.getLogger()\n  });\n};\n\nexports.factory = factory;\nvar CONNECTION_PARAMETER = '__cplay';\n\nvar PlaygroundPlugin =\n/** @class */\nfunction () {\n  function PlaygroundPlugin(configuration) {\n    this.sdkVersion = configuration.sdkVersion;\n    this.appId = configuration.appId;\n    this.connectionId = configuration.connectionId;\n    this.tab = configuration.tab;\n    this.contextFactory = configuration.contextFactory;\n    this.storage = configuration.storage;\n    this.eventSubscriber = configuration.eventSubscriber;\n    this.cidAssigner = configuration.cidAssigner;\n    this.tokenProvider = configuration.tokenProvider;\n    this.logger = configuration.logger;\n  }\n\n  PlaygroundPlugin.prototype.enable = function () {\n    var _this = this;\n\n    var connectionId = this.resolveConnectionId();\n\n    if (connectionId === null) {\n      return;\n    }\n\n    this.syncListener = function () {\n      return _this.cidAssigner.assignCid().then(function (cid) {\n        _this.syncToken(connectionId, cid);\n      }).catch(function (error) {\n        _this.logger.warn(\"Sync failed: \" + error_1.formatCause(error));\n      });\n    };\n\n    this.eventSubscriber.addListener('tokenChanged', this.syncListener);\n    this.tab.addListener('urlChange', this.syncListener);\n    return this.syncListener();\n  };\n\n  PlaygroundPlugin.prototype.resolveConnectionId = function () {\n    if (this.connectionId !== undefined) {\n      this.logger.debug('Connection ID passed in configuration');\n      return this.connectionId;\n    }\n\n    var url = new URL(this.tab.url);\n    var connectionId = url.searchParams.get(CONNECTION_PARAMETER);\n\n    if (connectionId === null || connectionId === '') {\n      this.logger.debug('No connection ID found in URL');\n      connectionId = this.storage.getItem('connectionId');\n      this.logger.debug(connectionId !== null ? 'Previous connection ID found' : 'No previous connection ID found');\n      return connectionId;\n    }\n\n    this.logger.debug('Connection ID found in URL');\n    this.storage.setItem('connectionId', connectionId);\n    return connectionId;\n  };\n\n  PlaygroundPlugin.prototype.disable = function () {\n    if (this.syncListener !== undefined) {\n      this.eventSubscriber.removeListener('tokenChanged', this.syncListener);\n      this.tab.removeListener('urlChange', this.syncListener);\n      delete this.syncListener;\n    }\n  };\n\n  PlaygroundPlugin.prototype.syncToken = function (connectionId, cid) {\n    var _this = this;\n\n    var iframe = document.createElement('iframe');\n    iframe.setAttribute('src', constants_1.PLAYGROUND_CONNECT_URL);\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin');\n    iframe.style.visibility = 'hidden';\n    iframe.style.opacity = '0';\n    iframe.style.border = '0';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    var context = this.createContext();\n\n    iframe.onload = function () {\n      var _a, _b;\n\n      if (iframe.contentWindow === null) {\n        if (document.body.contains(iframe)) {\n          document.body.removeChild(iframe);\n        }\n\n        _this.logger.warn('Sync handshake failed');\n\n        return;\n      }\n\n      var listener = function (event) {\n        if (event.origin !== constants_1.PLAYGROUND_ORIGIN || event.data !== connectionId) {\n          return;\n        }\n\n        window.removeEventListener('message', listener);\n\n        if (document.body.contains(iframe)) {\n          document.body.removeChild(iframe);\n        }\n\n        _this.logger.debug('Sync completed');\n      };\n\n      window.addEventListener('message', listener);\n      var payload = {\n        appId: _this.appId,\n        connectionId: connectionId,\n        sdkVersion: _this.sdkVersion,\n        tabId: _this.tab.id,\n        cid: cid,\n        token: (_b = (_a = _this.tokenProvider.getToken()) === null || _a === void 0 ? void 0 : _a.toString()) !== null && _b !== void 0 ? _b : null,\n        context: context\n      };\n      iframe.contentWindow.postMessage(payload, constants_1.PLAYGROUND_ORIGIN);\n\n      _this.logger.debug('Waiting for sync acknowledgment...');\n    };\n\n    this.logger.debug('Sync started');\n\n    var connect = function () {\n      document.body.appendChild(iframe);\n    };\n\n    if (document.body === null) {\n      document.addEventListener('DOMContentLoaded', connect);\n    } else {\n      connect();\n    }\n  };\n\n  PlaygroundPlugin.prototype.createContext = function () {\n    var _a = this.contextFactory.createContext(),\n        page = _a.page,\n        campaign = _a.campaign,\n        timezone = _a.timezone;\n\n    var context = {};\n\n    if (page !== undefined) {\n      context.page = page;\n    }\n\n    if (campaign !== undefined) {\n      context.campaign = campaign;\n    }\n\n    if (timezone !== undefined) {\n      context.timezone = timezone;\n    }\n\n    return context;\n  };\n\n  return PlaygroundPlugin;\n}();\n\nexports.PlaygroundPlugin = PlaygroundPlugin;","map":{"version":3,"names":["Object","defineProperty","exports","value","PlaygroundPlugin","factory","error_1","require","evaluatorFacade_1","constants_1","_a","sdk","options","sdkVersion","version","appId","connectionId","tab","storage","getTabStorage","tokenProvider","tokenStore","cidAssigner","contextFactory","TabContextFactory","eventSubscriber","eventManager","logger","getLogger","CONNECTION_PARAMETER","configuration","prototype","enable","_this","resolveConnectionId","syncListener","assignCid","then","cid","syncToken","catch","error","warn","formatCause","addListener","undefined","debug","url","URL","searchParams","get","getItem","setItem","disable","removeListener","iframe","document","createElement","setAttribute","PLAYGROUND_CONNECT_URL","style","visibility","opacity","border","width","height","context","createContext","onload","_b","contentWindow","body","contains","removeChild","listener","event","origin","PLAYGROUND_ORIGIN","data","window","removeEventListener","addEventListener","payload","tabId","id","token","getToken","toString","postMessage","connect","appendChild","page","campaign","timezone"],"sources":["C:/Users/User/croct/node_modules/@croct/plug/playground.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PlaygroundPlugin = exports.factory = void 0;\nvar error_1 = require(\"@croct/sdk/error\");\nvar evaluatorFacade_1 = require(\"@croct/sdk/facade/evaluatorFacade\");\nvar constants_1 = require(\"./constants\");\nvar factory = function (_a) {\n    var sdk = _a.sdk, options = _a.options;\n    return new PlaygroundPlugin({\n        sdkVersion: sdk.version,\n        appId: sdk.appId,\n        connectionId: options.connectionId,\n        tab: sdk.tab,\n        storage: sdk.getTabStorage(),\n        tokenProvider: sdk.tokenStore,\n        cidAssigner: sdk.cidAssigner,\n        contextFactory: new evaluatorFacade_1.TabContextFactory(sdk.tab),\n        eventSubscriber: sdk.eventManager,\n        logger: sdk.getLogger(),\n    });\n};\nexports.factory = factory;\nvar CONNECTION_PARAMETER = '__cplay';\nvar PlaygroundPlugin = /** @class */ (function () {\n    function PlaygroundPlugin(configuration) {\n        this.sdkVersion = configuration.sdkVersion;\n        this.appId = configuration.appId;\n        this.connectionId = configuration.connectionId;\n        this.tab = configuration.tab;\n        this.contextFactory = configuration.contextFactory;\n        this.storage = configuration.storage;\n        this.eventSubscriber = configuration.eventSubscriber;\n        this.cidAssigner = configuration.cidAssigner;\n        this.tokenProvider = configuration.tokenProvider;\n        this.logger = configuration.logger;\n    }\n    PlaygroundPlugin.prototype.enable = function () {\n        var _this = this;\n        var connectionId = this.resolveConnectionId();\n        if (connectionId === null) {\n            return;\n        }\n        this.syncListener = function () {\n            return _this.cidAssigner.assignCid()\n                .then(function (cid) {\n                _this.syncToken(connectionId, cid);\n            })\n                .catch(function (error) {\n                _this.logger.warn(\"Sync failed: \" + error_1.formatCause(error));\n            });\n        };\n        this.eventSubscriber.addListener('tokenChanged', this.syncListener);\n        this.tab.addListener('urlChange', this.syncListener);\n        return this.syncListener();\n    };\n    PlaygroundPlugin.prototype.resolveConnectionId = function () {\n        if (this.connectionId !== undefined) {\n            this.logger.debug('Connection ID passed in configuration');\n            return this.connectionId;\n        }\n        var url = new URL(this.tab.url);\n        var connectionId = url.searchParams.get(CONNECTION_PARAMETER);\n        if (connectionId === null || connectionId === '') {\n            this.logger.debug('No connection ID found in URL');\n            connectionId = this.storage.getItem('connectionId');\n            this.logger.debug(connectionId !== null\n                ? 'Previous connection ID found'\n                : 'No previous connection ID found');\n            return connectionId;\n        }\n        this.logger.debug('Connection ID found in URL');\n        this.storage.setItem('connectionId', connectionId);\n        return connectionId;\n    };\n    PlaygroundPlugin.prototype.disable = function () {\n        if (this.syncListener !== undefined) {\n            this.eventSubscriber.removeListener('tokenChanged', this.syncListener);\n            this.tab.removeListener('urlChange', this.syncListener);\n            delete this.syncListener;\n        }\n    };\n    PlaygroundPlugin.prototype.syncToken = function (connectionId, cid) {\n        var _this = this;\n        var iframe = document.createElement('iframe');\n        iframe.setAttribute('src', constants_1.PLAYGROUND_CONNECT_URL);\n        iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin');\n        iframe.style.visibility = 'hidden';\n        iframe.style.opacity = '0';\n        iframe.style.border = '0';\n        iframe.style.width = '0';\n        iframe.style.height = '0';\n        var context = this.createContext();\n        iframe.onload = function () {\n            var _a, _b;\n            if (iframe.contentWindow === null) {\n                if (document.body.contains(iframe)) {\n                    document.body.removeChild(iframe);\n                }\n                _this.logger.warn('Sync handshake failed');\n                return;\n            }\n            var listener = function (event) {\n                if (event.origin !== constants_1.PLAYGROUND_ORIGIN || event.data !== connectionId) {\n                    return;\n                }\n                window.removeEventListener('message', listener);\n                if (document.body.contains(iframe)) {\n                    document.body.removeChild(iframe);\n                }\n                _this.logger.debug('Sync completed');\n            };\n            window.addEventListener('message', listener);\n            var payload = {\n                appId: _this.appId,\n                connectionId: connectionId,\n                sdkVersion: _this.sdkVersion,\n                tabId: _this.tab.id,\n                cid: cid,\n                token: (_b = (_a = _this.tokenProvider.getToken()) === null || _a === void 0 ? void 0 : _a.toString()) !== null && _b !== void 0 ? _b : null,\n                context: context,\n            };\n            iframe.contentWindow.postMessage(payload, constants_1.PLAYGROUND_ORIGIN);\n            _this.logger.debug('Waiting for sync acknowledgment...');\n        };\n        this.logger.debug('Sync started');\n        var connect = function () {\n            document.body.appendChild(iframe);\n        };\n        if (document.body === null) {\n            document.addEventListener('DOMContentLoaded', connect);\n        }\n        else {\n            connect();\n        }\n    };\n    PlaygroundPlugin.prototype.createContext = function () {\n        var _a = this.contextFactory.createContext(), page = _a.page, campaign = _a.campaign, timezone = _a.timezone;\n        var context = {};\n        if (page !== undefined) {\n            context.page = page;\n        }\n        if (campaign !== undefined) {\n            context.campaign = campaign;\n        }\n        if (timezone !== undefined) {\n            context.timezone = timezone;\n        }\n        return context;\n    };\n    return PlaygroundPlugin;\n}());\nexports.PlaygroundPlugin = PlaygroundPlugin;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}
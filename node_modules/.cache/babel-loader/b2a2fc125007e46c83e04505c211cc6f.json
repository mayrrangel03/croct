{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FixedTokenProvider = exports.Token = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar base64Url_1 = require(\"../base64Url\");\n\nvar schema_1 = require(\"../schema\");\n\nvar error_1 = require(\"../error\");\n\nvar Token =\n/** @class */\nfunction () {\n  function Token(headers, claims, signature) {\n    if (signature === void 0) {\n      signature = '';\n    }\n\n    this.headers = headers;\n    this.claims = claims;\n    this.signature = signature;\n  }\n\n  Token.issue = function (appId, subject, timestamp) {\n    if (subject === void 0) {\n      subject = null;\n    }\n\n    if (timestamp === void 0) {\n      timestamp = Math.floor(Date.now() / 1000);\n    }\n\n    if (timestamp < 0) {\n      throw new Error('The timestamp must be non-negative.');\n    }\n\n    if (subject === '') {\n      throw new Error('The subject must be non-empty.');\n    }\n\n    return new Token({\n      typ: 'JWT',\n      alg: 'none',\n      appId: appId\n    }, tslib_1.__assign({\n      iss: 'croct.io',\n      aud: 'croct.io',\n      iat: timestamp\n    }, subject !== null ? {\n      sub: subject\n    } : null));\n  };\n\n  Token.parse = function (token) {\n    if (token === '') {\n      throw new Error('The token cannot be empty.');\n    }\n\n    var parts = token.split('.', 3); // This token is invalid\n\n    if (parts.length < 2) {\n      throw new Error('The token is malformed.');\n    }\n\n    var headers;\n    var claims;\n    var signature;\n\n    try {\n      headers = JSON.parse((0, base64Url_1.base64UrlDecode)(parts[0]));\n      claims = JSON.parse((0, base64Url_1.base64UrlDecode)(parts[1]));\n\n      if (parts.length === 3) {\n        signature = (0, base64Url_1.base64UrlDecode)(parts[2]);\n      }\n    } catch (_a) {\n      throw new Error('The token is corrupted.');\n    }\n\n    try {\n      schema_1.tokenSchema.validate({\n        headers: headers,\n        claims: claims,\n        signature: signature\n      });\n    } catch (violation) {\n      throw new Error(\"The token is invalid: \".concat((0, error_1.formatCause)(violation)));\n    }\n\n    return new Token(headers, claims, signature);\n  };\n\n  Token.prototype.getHeaders = function () {\n    return tslib_1.__assign({}, this.headers);\n  };\n\n  Token.prototype.getClaims = function () {\n    return tslib_1.__assign({}, this.claims);\n  };\n\n  Token.prototype.getSignature = function () {\n    return this.signature;\n  };\n\n  Token.prototype.isAnonymous = function () {\n    return this.claims.sub === undefined;\n  };\n\n  Token.prototype.getSubject = function () {\n    return this.claims.sub !== undefined ? this.claims.sub : null;\n  };\n\n  Token.prototype.getIssueTime = function () {\n    return this.claims.iat;\n  };\n\n  Token.prototype.toJSON = function () {\n    return this.toString();\n  };\n\n  Token.prototype.toString = function () {\n    var headers = (0, base64Url_1.base64UrlEncode)(JSON.stringify(this.headers));\n    var claims = (0, base64Url_1.base64UrlEncode)(JSON.stringify(this.claims));\n    var signature = (0, base64Url_1.base64UrlEncode)(this.signature);\n    return \"\".concat(headers, \".\").concat(claims, \".\").concat(signature);\n  };\n\n  return Token;\n}();\n\nexports.Token = Token;\n\nvar FixedTokenProvider =\n/** @class */\nfunction () {\n  function FixedTokenProvider(token) {\n    this.token = token;\n  }\n\n  FixedTokenProvider.prototype.getToken = function () {\n    return this.token;\n  };\n\n  return FixedTokenProvider;\n}();\n\nexports.FixedTokenProvider = FixedTokenProvider;","map":{"version":3,"names":["Object","defineProperty","exports","value","FixedTokenProvider","Token","tslib_1","require","base64Url_1","schema_1","error_1","headers","claims","signature","issue","appId","subject","timestamp","Math","floor","Date","now","Error","typ","alg","__assign","iss","aud","iat","sub","parse","token","parts","split","length","JSON","base64UrlDecode","_a","tokenSchema","validate","violation","concat","formatCause","prototype","getHeaders","getClaims","getSignature","isAnonymous","undefined","getSubject","getIssueTime","toJSON","toString","base64UrlEncode","stringify","getToken"],"sources":["C:/Users/User/croct/node_modules/@croct/sdk/token/token.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FixedTokenProvider = exports.Token = void 0;\nvar tslib_1 = require(\"tslib\");\nvar base64Url_1 = require(\"../base64Url\");\nvar schema_1 = require(\"../schema\");\nvar error_1 = require(\"../error\");\nvar Token = /** @class */ (function () {\n    function Token(headers, claims, signature) {\n        if (signature === void 0) { signature = ''; }\n        this.headers = headers;\n        this.claims = claims;\n        this.signature = signature;\n    }\n    Token.issue = function (appId, subject, timestamp) {\n        if (subject === void 0) { subject = null; }\n        if (timestamp === void 0) { timestamp = Math.floor(Date.now() / 1000); }\n        if (timestamp < 0) {\n            throw new Error('The timestamp must be non-negative.');\n        }\n        if (subject === '') {\n            throw new Error('The subject must be non-empty.');\n        }\n        return new Token({\n            typ: 'JWT',\n            alg: 'none',\n            appId: appId,\n        }, tslib_1.__assign({ iss: 'croct.io', aud: 'croct.io', iat: timestamp }, (subject !== null ? { sub: subject } : null)));\n    };\n    Token.parse = function (token) {\n        if (token === '') {\n            throw new Error('The token cannot be empty.');\n        }\n        var parts = token.split('.', 3);\n        // This token is invalid\n        if (parts.length < 2) {\n            throw new Error('The token is malformed.');\n        }\n        var headers;\n        var claims;\n        var signature;\n        try {\n            headers = JSON.parse((0, base64Url_1.base64UrlDecode)(parts[0]));\n            claims = JSON.parse((0, base64Url_1.base64UrlDecode)(parts[1]));\n            if (parts.length === 3) {\n                signature = (0, base64Url_1.base64UrlDecode)(parts[2]);\n            }\n        }\n        catch (_a) {\n            throw new Error('The token is corrupted.');\n        }\n        try {\n            schema_1.tokenSchema.validate({ headers: headers, claims: claims, signature: signature });\n        }\n        catch (violation) {\n            throw new Error(\"The token is invalid: \".concat((0, error_1.formatCause)(violation)));\n        }\n        return new Token(headers, claims, signature);\n    };\n    Token.prototype.getHeaders = function () {\n        return tslib_1.__assign({}, this.headers);\n    };\n    Token.prototype.getClaims = function () {\n        return tslib_1.__assign({}, this.claims);\n    };\n    Token.prototype.getSignature = function () {\n        return this.signature;\n    };\n    Token.prototype.isAnonymous = function () {\n        return this.claims.sub === undefined;\n    };\n    Token.prototype.getSubject = function () {\n        return this.claims.sub !== undefined ? this.claims.sub : null;\n    };\n    Token.prototype.getIssueTime = function () {\n        return this.claims.iat;\n    };\n    Token.prototype.toJSON = function () {\n        return this.toString();\n    };\n    Token.prototype.toString = function () {\n        var headers = (0, base64Url_1.base64UrlEncode)(JSON.stringify(this.headers));\n        var claims = (0, base64Url_1.base64UrlEncode)(JSON.stringify(this.claims));\n        var signature = (0, base64Url_1.base64UrlEncode)(this.signature);\n        return \"\".concat(headers, \".\").concat(claims, \".\").concat(signature);\n    };\n    return Token;\n}());\nexports.Token = Token;\nvar FixedTokenProvider = /** @class */ (function () {\n    function FixedTokenProvider(token) {\n        this.token = token;\n    }\n    FixedTokenProvider.prototype.getToken = function () {\n        return this.token;\n    };\n    return FixedTokenProvider;\n}());\nexports.FixedTokenProvider = FixedTokenProvider;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}
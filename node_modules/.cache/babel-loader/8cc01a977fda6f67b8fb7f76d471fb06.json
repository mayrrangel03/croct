{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MonitoredQueue = void 0;\n\nvar logging_1 = require(\"../logging\");\n\nvar MonitoredQueue =\n/** @class */\nfunction () {\n  function MonitoredQueue(queue, logger) {\n    this.callbacks = {};\n    this.queue = queue;\n    this.logger = logger !== null && logger !== void 0 ? logger : new logging_1.NullLogger();\n    this.updateStatus();\n  }\n\n  MonitoredQueue.prototype.all = function () {\n    return this.queue.all();\n  };\n\n  MonitoredQueue.prototype.getCapacity = function () {\n    return this.queue.getCapacity();\n  };\n\n  MonitoredQueue.prototype.addCallback = function (status, callback) {\n    var callbacks = this.callbacks[status] || [];\n\n    if (!callbacks.includes(callback)) {\n      callbacks.push(callback);\n    }\n\n    this.callbacks[status] = callbacks;\n\n    switch (this.status) {\n      case status:\n        callback(this);\n        break;\n\n      case 'empty':\n      case 'almostEmpty':\n        if (status === 'halfEmpty') {\n          callback(this);\n        }\n\n        break;\n\n      case 'full':\n      case 'almostFull':\n        if (status === 'halfFull') {\n          callback(this);\n        }\n\n        break;\n    }\n  };\n\n  MonitoredQueue.prototype.removeCallback = function (type, callback) {\n    var callbacks = this.callbacks[type];\n\n    if (!callbacks) {\n      return;\n    }\n\n    var index = callbacks.indexOf(callback);\n\n    if (index >= 0) {\n      callbacks.splice(index, 1);\n    }\n  };\n\n  MonitoredQueue.prototype.setStatus = function (status) {\n    if (this.status === status) {\n      return;\n    }\n\n    this.logger.debug(\"Queue status changed to \\\"\".concat(status, \"\\\"\"));\n    this.report(status);\n    this.status = status;\n  };\n\n  MonitoredQueue.prototype.report = function (status) {\n    var _this = this;\n\n    var callbacks = this.callbacks[status];\n\n    if (callbacks !== undefined) {\n      callbacks.forEach(function (callback) {\n        return callback(_this);\n      });\n    }\n\n    switch (status) {\n      case 'empty':\n      case 'almostEmpty':\n        this.report('halfEmpty');\n        break;\n\n      case 'full':\n      case 'almostFull':\n        this.report('halfFull');\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  MonitoredQueue.prototype.isEmpty = function () {\n    return this.queue.isEmpty();\n  };\n\n  MonitoredQueue.prototype.length = function () {\n    return this.queue.length();\n  };\n\n  MonitoredQueue.prototype.peek = function () {\n    return this.queue.peek();\n  };\n\n  MonitoredQueue.prototype.push = function (value) {\n    this.queue.push(value);\n    this.updateStatus();\n  };\n\n  MonitoredQueue.prototype.shift = function () {\n    var value = this.queue.shift();\n    this.updateStatus();\n    return value;\n  };\n\n  MonitoredQueue.prototype.updateStatus = function () {\n    var length = this.queue.length();\n    var capacity = this.getCapacity();\n\n    if (length <= capacity * 0.5) {\n      if (length === 0) {\n        this.setStatus('empty');\n      } else if (length <= capacity * 0.25) {\n        this.setStatus('almostEmpty');\n      } else {\n        this.setStatus('halfEmpty');\n      }\n\n      return;\n    }\n\n    if (length >= capacity) {\n      this.setStatus('full');\n    } else if (length >= capacity * 0.75) {\n      this.setStatus('almostFull');\n    } else {\n      this.setStatus('halfFull');\n    }\n  };\n\n  return MonitoredQueue;\n}();\n\nexports.MonitoredQueue = MonitoredQueue;","map":{"version":3,"names":["Object","defineProperty","exports","value","MonitoredQueue","logging_1","require","queue","logger","callbacks","NullLogger","updateStatus","prototype","all","getCapacity","addCallback","status","callback","includes","push","removeCallback","type","index","indexOf","splice","setStatus","debug","concat","report","_this","undefined","forEach","isEmpty","length","peek","shift","capacity"],"sources":["C:/Users/User/croct/node_modules/@croct/sdk/queue/monitoredQueue.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MonitoredQueue = void 0;\nvar logging_1 = require(\"../logging\");\nvar MonitoredQueue = /** @class */ (function () {\n    function MonitoredQueue(queue, logger) {\n        this.callbacks = {};\n        this.queue = queue;\n        this.logger = logger !== null && logger !== void 0 ? logger : new logging_1.NullLogger();\n        this.updateStatus();\n    }\n    MonitoredQueue.prototype.all = function () {\n        return this.queue.all();\n    };\n    MonitoredQueue.prototype.getCapacity = function () {\n        return this.queue.getCapacity();\n    };\n    MonitoredQueue.prototype.addCallback = function (status, callback) {\n        var callbacks = this.callbacks[status] || [];\n        if (!callbacks.includes(callback)) {\n            callbacks.push(callback);\n        }\n        this.callbacks[status] = callbacks;\n        switch (this.status) {\n            case status:\n                callback(this);\n                break;\n            case 'empty':\n            case 'almostEmpty':\n                if (status === 'halfEmpty') {\n                    callback(this);\n                }\n                break;\n            case 'full':\n            case 'almostFull':\n                if (status === 'halfFull') {\n                    callback(this);\n                }\n                break;\n        }\n    };\n    MonitoredQueue.prototype.removeCallback = function (type, callback) {\n        var callbacks = this.callbacks[type];\n        if (!callbacks) {\n            return;\n        }\n        var index = callbacks.indexOf(callback);\n        if (index >= 0) {\n            callbacks.splice(index, 1);\n        }\n    };\n    MonitoredQueue.prototype.setStatus = function (status) {\n        if (this.status === status) {\n            return;\n        }\n        this.logger.debug(\"Queue status changed to \\\"\".concat(status, \"\\\"\"));\n        this.report(status);\n        this.status = status;\n    };\n    MonitoredQueue.prototype.report = function (status) {\n        var _this = this;\n        var callbacks = this.callbacks[status];\n        if (callbacks !== undefined) {\n            callbacks.forEach(function (callback) { return callback(_this); });\n        }\n        switch (status) {\n            case 'empty':\n            case 'almostEmpty':\n                this.report('halfEmpty');\n                break;\n            case 'full':\n            case 'almostFull':\n                this.report('halfFull');\n                break;\n            default:\n                break;\n        }\n    };\n    MonitoredQueue.prototype.isEmpty = function () {\n        return this.queue.isEmpty();\n    };\n    MonitoredQueue.prototype.length = function () {\n        return this.queue.length();\n    };\n    MonitoredQueue.prototype.peek = function () {\n        return this.queue.peek();\n    };\n    MonitoredQueue.prototype.push = function (value) {\n        this.queue.push(value);\n        this.updateStatus();\n    };\n    MonitoredQueue.prototype.shift = function () {\n        var value = this.queue.shift();\n        this.updateStatus();\n        return value;\n    };\n    MonitoredQueue.prototype.updateStatus = function () {\n        var length = this.queue.length();\n        var capacity = this.getCapacity();\n        if (length <= capacity * 0.5) {\n            if (length === 0) {\n                this.setStatus('empty');\n            }\n            else if (length <= capacity * 0.25) {\n                this.setStatus('almostEmpty');\n            }\n            else {\n                this.setStatus('halfEmpty');\n            }\n            return;\n        }\n        if (length >= capacity) {\n            this.setStatus('full');\n        }\n        else if (length >= capacity * 0.75) {\n            this.setStatus('almostFull');\n        }\n        else {\n            this.setStatus('halfFull');\n        }\n    };\n    return MonitoredQueue;\n}());\nexports.MonitoredQueue = MonitoredQueue;\n"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,cAAR,GAAyB,KAAK,CAA9B;;AACA,IAAIC,SAAS,GAAGC,OAAO,CAAC,YAAD,CAAvB;;AACA,IAAIF,cAAc;AAAG;AAAe,YAAY;EAC5C,SAASA,cAAT,CAAwBG,KAAxB,EAA+BC,MAA/B,EAAuC;IACnC,KAAKC,SAAL,GAAiB,EAAjB;IACA,KAAKF,KAAL,GAAaA,KAAb;IACA,KAAKC,MAAL,GAAcA,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuCA,MAAvC,GAAgD,IAAIH,SAAS,CAACK,UAAd,EAA9D;IACA,KAAKC,YAAL;EACH;;EACDP,cAAc,CAACQ,SAAf,CAAyBC,GAAzB,GAA+B,YAAY;IACvC,OAAO,KAAKN,KAAL,CAAWM,GAAX,EAAP;EACH,CAFD;;EAGAT,cAAc,CAACQ,SAAf,CAAyBE,WAAzB,GAAuC,YAAY;IAC/C,OAAO,KAAKP,KAAL,CAAWO,WAAX,EAAP;EACH,CAFD;;EAGAV,cAAc,CAACQ,SAAf,CAAyBG,WAAzB,GAAuC,UAAUC,MAAV,EAAkBC,QAAlB,EAA4B;IAC/D,IAAIR,SAAS,GAAG,KAAKA,SAAL,CAAeO,MAAf,KAA0B,EAA1C;;IACA,IAAI,CAACP,SAAS,CAACS,QAAV,CAAmBD,QAAnB,CAAL,EAAmC;MAC/BR,SAAS,CAACU,IAAV,CAAeF,QAAf;IACH;;IACD,KAAKR,SAAL,CAAeO,MAAf,IAAyBP,SAAzB;;IACA,QAAQ,KAAKO,MAAb;MACI,KAAKA,MAAL;QACIC,QAAQ,CAAC,IAAD,CAAR;QACA;;MACJ,KAAK,OAAL;MACA,KAAK,aAAL;QACI,IAAID,MAAM,KAAK,WAAf,EAA4B;UACxBC,QAAQ,CAAC,IAAD,CAAR;QACH;;QACD;;MACJ,KAAK,MAAL;MACA,KAAK,YAAL;QACI,IAAID,MAAM,KAAK,UAAf,EAA2B;UACvBC,QAAQ,CAAC,IAAD,CAAR;QACH;;QACD;IAfR;EAiBH,CAvBD;;EAwBAb,cAAc,CAACQ,SAAf,CAAyBQ,cAAzB,GAA0C,UAAUC,IAAV,EAAgBJ,QAAhB,EAA0B;IAChE,IAAIR,SAAS,GAAG,KAAKA,SAAL,CAAeY,IAAf,CAAhB;;IACA,IAAI,CAACZ,SAAL,EAAgB;MACZ;IACH;;IACD,IAAIa,KAAK,GAAGb,SAAS,CAACc,OAAV,CAAkBN,QAAlB,CAAZ;;IACA,IAAIK,KAAK,IAAI,CAAb,EAAgB;MACZb,SAAS,CAACe,MAAV,CAAiBF,KAAjB,EAAwB,CAAxB;IACH;EACJ,CATD;;EAUAlB,cAAc,CAACQ,SAAf,CAAyBa,SAAzB,GAAqC,UAAUT,MAAV,EAAkB;IACnD,IAAI,KAAKA,MAAL,KAAgBA,MAApB,EAA4B;MACxB;IACH;;IACD,KAAKR,MAAL,CAAYkB,KAAZ,CAAkB,6BAA6BC,MAA7B,CAAoCX,MAApC,EAA4C,IAA5C,CAAlB;IACA,KAAKY,MAAL,CAAYZ,MAAZ;IACA,KAAKA,MAAL,GAAcA,MAAd;EACH,CAPD;;EAQAZ,cAAc,CAACQ,SAAf,CAAyBgB,MAAzB,GAAkC,UAAUZ,MAAV,EAAkB;IAChD,IAAIa,KAAK,GAAG,IAAZ;;IACA,IAAIpB,SAAS,GAAG,KAAKA,SAAL,CAAeO,MAAf,CAAhB;;IACA,IAAIP,SAAS,KAAKqB,SAAlB,EAA6B;MACzBrB,SAAS,CAACsB,OAAV,CAAkB,UAAUd,QAAV,EAAoB;QAAE,OAAOA,QAAQ,CAACY,KAAD,CAAf;MAAyB,CAAjE;IACH;;IACD,QAAQb,MAAR;MACI,KAAK,OAAL;MACA,KAAK,aAAL;QACI,KAAKY,MAAL,CAAY,WAAZ;QACA;;MACJ,KAAK,MAAL;MACA,KAAK,YAAL;QACI,KAAKA,MAAL,CAAY,UAAZ;QACA;;MACJ;QACI;IAVR;EAYH,CAlBD;;EAmBAxB,cAAc,CAACQ,SAAf,CAAyBoB,OAAzB,GAAmC,YAAY;IAC3C,OAAO,KAAKzB,KAAL,CAAWyB,OAAX,EAAP;EACH,CAFD;;EAGA5B,cAAc,CAACQ,SAAf,CAAyBqB,MAAzB,GAAkC,YAAY;IAC1C,OAAO,KAAK1B,KAAL,CAAW0B,MAAX,EAAP;EACH,CAFD;;EAGA7B,cAAc,CAACQ,SAAf,CAAyBsB,IAAzB,GAAgC,YAAY;IACxC,OAAO,KAAK3B,KAAL,CAAW2B,IAAX,EAAP;EACH,CAFD;;EAGA9B,cAAc,CAACQ,SAAf,CAAyBO,IAAzB,GAAgC,UAAUhB,KAAV,EAAiB;IAC7C,KAAKI,KAAL,CAAWY,IAAX,CAAgBhB,KAAhB;IACA,KAAKQ,YAAL;EACH,CAHD;;EAIAP,cAAc,CAACQ,SAAf,CAAyBuB,KAAzB,GAAiC,YAAY;IACzC,IAAIhC,KAAK,GAAG,KAAKI,KAAL,CAAW4B,KAAX,EAAZ;IACA,KAAKxB,YAAL;IACA,OAAOR,KAAP;EACH,CAJD;;EAKAC,cAAc,CAACQ,SAAf,CAAyBD,YAAzB,GAAwC,YAAY;IAChD,IAAIsB,MAAM,GAAG,KAAK1B,KAAL,CAAW0B,MAAX,EAAb;IACA,IAAIG,QAAQ,GAAG,KAAKtB,WAAL,EAAf;;IACA,IAAImB,MAAM,IAAIG,QAAQ,GAAG,GAAzB,EAA8B;MAC1B,IAAIH,MAAM,KAAK,CAAf,EAAkB;QACd,KAAKR,SAAL,CAAe,OAAf;MACH,CAFD,MAGK,IAAIQ,MAAM,IAAIG,QAAQ,GAAG,IAAzB,EAA+B;QAChC,KAAKX,SAAL,CAAe,aAAf;MACH,CAFI,MAGA;QACD,KAAKA,SAAL,CAAe,WAAf;MACH;;MACD;IACH;;IACD,IAAIQ,MAAM,IAAIG,QAAd,EAAwB;MACpB,KAAKX,SAAL,CAAe,MAAf;IACH,CAFD,MAGK,IAAIQ,MAAM,IAAIG,QAAQ,GAAG,IAAzB,EAA+B;MAChC,KAAKX,SAAL,CAAe,YAAf;IACH,CAFI,MAGA;MACD,KAAKA,SAAL,CAAe,UAAf;IACH;EACJ,CAxBD;;EAyBA,OAAOrB,cAAP;AACH,CAtHmC,EAApC;;AAuHAF,OAAO,CAACE,cAAR,GAAyBA,cAAzB"},"metadata":{},"sourceType":"script"}
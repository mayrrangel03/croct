{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GlobalPlug = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar sdkFacade_1 = require(\"@croct/sdk/facade/sdkFacade\");\n\nvar error_1 = require(\"@croct/sdk/error\");\n\nvar validation_1 = require(\"@croct/sdk/validation\");\n\nvar token_1 = require(\"@croct/sdk/token\");\n\nvar sdk_1 = require(\"@croct/sdk\");\n\nvar constants_1 = require(\"./constants\");\n\nvar playground_1 = require(\"./playground\");\n\nvar PLUGIN_NAMESPACE = 'Plugin';\n\nfunction detectAppId() {\n  var script = window.document.querySelector(\"script[src^='\" + constants_1.CDN_URL + \"']\");\n\n  if (!(script instanceof HTMLScriptElement)) {\n    return null;\n  }\n\n  return new URL(script.src).searchParams.get('appId');\n}\n\nvar GlobalPlug =\n/** @class */\nfunction () {\n  function GlobalPlug() {\n    var _this = this;\n\n    this.pluginFactories = {\n      playground: playground_1.factory\n    };\n    this.plugins = {};\n    this.ready = new Promise(function (resolve) {\n      _this.initialize = resolve;\n    });\n  }\n\n  GlobalPlug.prototype.extend = function (name, plugin) {\n    if (this.pluginFactories[name] !== undefined) {\n      throw new Error(\"Another plugin is already registered with name \\\"\" + name + \"\\\".\");\n    }\n\n    this.pluginFactories[name] = plugin;\n  };\n\n  GlobalPlug.prototype.plug = function (configuration) {\n    var e_1, _a;\n\n    var _this = this;\n\n    var _b, _c, _d, _e;\n\n    if (configuration === void 0) {\n      configuration = {};\n    }\n\n    if (this.instance !== undefined) {\n      var logger_1 = this.instance.getLogger();\n      logger_1.info('Croct is already plugged in.');\n      return;\n    }\n\n    var detectedAppId = detectAppId();\n    var configuredAppId = (_b = configuration.appId) !== null && _b !== void 0 ? _b : null;\n\n    if (detectedAppId !== null && configuredAppId !== null && detectedAppId !== configuredAppId) {\n      throw new Error('The specified app ID and the auto-detected app ID are conflicting. ' + 'There is no need to specify an app ID when using an application-specific tag. ' + 'Please try again omitting the \"appId\" option.');\n    }\n\n    var appId = detectedAppId !== null && detectedAppId !== void 0 ? detectedAppId : configuredAppId;\n\n    if (appId === null) {\n      throw new Error('The app ID must be specified when it cannot be auto-detected. ' + 'Please try again specifying the \"appId\" option.');\n    }\n\n    var plugins = configuration.plugins,\n        test = configuration.test,\n        sdkConfiguration = tslib_1.__rest(configuration, [\"plugins\", \"test\"]);\n\n    var sdk = sdkFacade_1.SdkFacade.init(tslib_1.__assign(tslib_1.__assign({}, sdkConfiguration), {\n      appId: appId,\n      test: test !== null && test !== void 0 ? test : typeof process === 'object' && (((_c = process.env) === null || _c === void 0 ? void 0 : _c.CROCT_TEST_MODE) !== undefined ? process.env.CROCT_TEST_MODE === 'true' : ((_d = process.env) === null || _d === void 0 ? void 0 : _d.NODE_ENV) === 'test')\n    }));\n    this.instance = sdk;\n    var logger = this.instance.getLogger();\n\n    if (detectedAppId === configuredAppId) {\n      logger.warn('It is strongly recommended omitting the \"appId\" option when using ' + 'the application-specific tag as it is detected automatically.');\n    }\n\n    var pending = [];\n\n    var _loop_1 = function (name_1, options) {\n      logger.debug(\"Initializing plugin \\\"\" + name_1 + \"\\\"...\");\n      var factory = this_1.pluginFactories[name_1];\n\n      if (factory === undefined) {\n        logger.error(\"Plugin \\\"\" + name_1 + \"\\\" is not registered.\");\n        return \"continue\";\n      }\n\n      if (typeof options !== 'boolean' && (options === null || typeof options !== 'object')) {\n        logger.error(\"Invalid options for plugin \\\"\" + name_1 + \"\\\", \" + (\"expected either boolean or object but got \" + validation_1.describe(options)));\n        return \"continue\";\n      }\n\n      if (options === false) {\n        logger.warn(\"Plugin \\\"\" + name_1 + \"\\\" is declared but not enabled\");\n        return \"continue\";\n      }\n\n      var args = {\n        options: options === true ? {} : options,\n        sdk: {\n          version: sdk_1.VERSION,\n          appId: appId,\n          tracker: sdk.tracker,\n          evaluator: sdk.evaluator,\n          user: sdk.user,\n          session: sdk.session,\n          tab: sdk.context.getTab(),\n          tokenStore: {\n            getToken: sdk.getToken.bind(sdk),\n            setToken: sdk.setToken.bind(sdk)\n          },\n          cidAssigner: sdk.cidAssigner,\n          eventManager: sdk.eventManager,\n          getLogger: function () {\n            var namespace = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              namespace[_i] = arguments[_i];\n            }\n\n            return sdk.getLogger.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n          },\n          getTabStorage: function () {\n            var namespace = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              namespace[_i] = arguments[_i];\n            }\n\n            return sdk.getTabStorage.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n          },\n          getBrowserStorage: function () {\n            var namespace = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              namespace[_i] = arguments[_i];\n            }\n\n            return sdk.getBrowserStorage.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n          }\n        }\n      };\n      var plugin = void 0;\n\n      try {\n        plugin = factory(args);\n      } catch (error) {\n        logger.error(\"Failed to initialize plugin \\\"\" + name_1 + \"\\\": \" + error_1.formatCause(error));\n        return \"continue\";\n      }\n\n      logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" initialized\");\n\n      if (typeof plugin !== 'object') {\n        return \"continue\";\n      }\n\n      this_1.plugins[name_1] = plugin;\n      var promise = plugin.enable();\n\n      if (!(promise instanceof Promise)) {\n        logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" enabled\");\n        return \"continue\";\n      }\n\n      pending.push(promise.then(function () {\n        return logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" enabled\");\n      }).catch(function (error) {\n        return logger.error(\"Failed to enable plugin \\\"\" + name_1 + \"\\\": \" + error_1.formatCause(error));\n      }));\n    };\n\n    var this_1 = this;\n\n    try {\n      for (var _f = tslib_1.__values(Object.entries(tslib_1.__assign({\n        playground: true\n      }, plugins))), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var _h = tslib_1.__read(_g.value, 2),\n            name_1 = _h[0],\n            options = _h[1];\n\n        _loop_1(name_1, options);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    var initializeEap = (_e = window.croctEap) === null || _e === void 0 ? void 0 : _e.initialize;\n\n    if (typeof initializeEap === 'function') {\n      initializeEap.call(this);\n    }\n\n    Promise.all(pending).then(function () {\n      _this.initialize();\n\n      logger.debug('Initialization complete');\n    });\n  };\n\n  Object.defineProperty(GlobalPlug.prototype, \"initialized\", {\n    get: function () {\n      return this.instance !== undefined;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"plugged\", {\n    get: function () {\n      var _this = this;\n\n      return this.ready.then(function () {\n        return _this;\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"flushed\", {\n    get: function () {\n      var _this = this;\n\n      return this.tracker.flushed.then(function () {\n        return _this;\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"sdk\", {\n    get: function () {\n      if (this.instance === undefined) {\n        throw new Error('Croct is not plugged in.');\n      }\n\n      return this.instance;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"tracker\", {\n    get: function () {\n      return this.sdk.tracker;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"evaluator\", {\n    get: function () {\n      return this.sdk.evaluator;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"user\", {\n    get: function () {\n      return this.sdk.user;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(GlobalPlug.prototype, \"session\", {\n    get: function () {\n      return this.sdk.session;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  GlobalPlug.prototype.isAnonymous = function () {\n    return this.sdk.context.isAnonymous();\n  };\n\n  GlobalPlug.prototype.getUserId = function () {\n    return this.sdk.context.getUser();\n  };\n\n  GlobalPlug.prototype.identify = function (userId) {\n    if (typeof userId !== 'string') {\n      throw new Error('The user ID must be a string. Read more on https://croct.help/plug-js/id-conversion');\n    }\n\n    this.sdk.identify(userId);\n  };\n\n  GlobalPlug.prototype.anonymize = function () {\n    this.sdk.anonymize();\n  };\n\n  GlobalPlug.prototype.setToken = function (token) {\n    this.sdk.setToken(token_1.Token.parse(token));\n  };\n\n  GlobalPlug.prototype.unsetToken = function () {\n    this.sdk.unsetToken();\n  };\n\n  GlobalPlug.prototype.track = function (type, payload) {\n    return this.sdk.tracker.track(type, payload);\n  };\n\n  GlobalPlug.prototype.evaluate = function (expression, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return this.sdk.evaluator.evaluate(expression, options);\n  };\n\n  GlobalPlug.prototype.test = function (expression, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return this.evaluate(expression, options).then(function (result) {\n      return result === true;\n    });\n  };\n  /**\n   * This API is unstable and subject to change in future releases.\n   */\n\n\n  GlobalPlug.prototype.fetch = function (slotId, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return this.eap('fetch').call(this, slotId, options);\n  };\n\n  GlobalPlug.prototype.unplug = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a, instance, plugins, logger, pending, _loop_2, _b, _c, _d, pluginName, controller;\n\n      var e_2, _e;\n\n      var _this = this;\n\n      return tslib_1.__generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            if (this.instance === undefined) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            _a = this, instance = _a.instance, plugins = _a.plugins;\n            logger = this.sdk.getLogger();\n            pending = [];\n\n            _loop_2 = function (pluginName, controller) {\n              if (typeof controller.disable !== 'function') {\n                return \"continue\";\n              }\n\n              logger.debug(\"Disabling plugin \\\"\" + pluginName + \"\\\"...\");\n              var promise = controller.disable();\n\n              if (!(promise instanceof Promise)) {\n                logger.debug(\"Plugin \\\"\" + pluginName + \"\\\" disabled\");\n                return \"continue\";\n              }\n\n              pending.push(promise.then(function () {\n                return logger.debug(\"Plugin \\\"\" + pluginName + \"\\\" disabled\");\n              }).catch(function (error) {\n                return logger.error(\"Failed to disable \\\"\" + pluginName + \"\\\": \" + error_1.formatCause(error));\n              }));\n            };\n\n            try {\n              for (_b = tslib_1.__values(Object.entries(plugins)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                _d = tslib_1.__read(_c.value, 2), pluginName = _d[0], controller = _d[1];\n\n                _loop_2(pluginName, controller);\n              }\n            } catch (e_2_1) {\n              e_2 = {\n                error: e_2_1\n              };\n            } finally {\n              try {\n                if (_c && !_c.done && (_e = _b.return)) _e.call(_b);\n              } finally {\n                if (e_2) throw e_2.error;\n              }\n            } // Reset\n\n\n            delete this.instance;\n            this.plugins = {};\n            this.ready = new Promise(function (resolve) {\n              _this.initialize = resolve;\n            });\n            return [4\n            /*yield*/\n            , Promise.all(pending)];\n\n          case 1:\n            _f.sent();\n\n            _f.label = 2;\n\n          case 2:\n            _f.trys.push([2,, 4, 5]);\n\n            return [4\n            /*yield*/\n            , instance.close()];\n\n          case 3:\n            _f.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            logger.info('ðŸ”Œ Croct has been unplugged.');\n            return [7\n            /*endfinally*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  GlobalPlug.prototype.eap = function (feature) {\n    var logger = this.sdk.getLogger();\n    var eap = window.croctEap;\n    var method = typeof eap === 'object' ? eap[feature] : undefined;\n\n    if (typeof method !== 'function') {\n      throw new Error(\"The \" + feature + \" feature is currently available only to accounts participating in our \" + 'Early-Access Program (EAP). Please contact your Customer Success Manager or email eap@croct.com ' + 'to check your account eligibility.');\n    }\n\n    logger.warn(\"The \" + feature + \" API is still unstable and subject to change in future releases.\");\n    return method;\n  };\n\n  return GlobalPlug;\n}();\n\nexports.GlobalPlug = GlobalPlug;","map":{"version":3,"names":["Object","defineProperty","exports","value","GlobalPlug","tslib_1","require","sdkFacade_1","error_1","validation_1","token_1","sdk_1","constants_1","playground_1","PLUGIN_NAMESPACE","detectAppId","script","window","document","querySelector","CDN_URL","HTMLScriptElement","URL","src","searchParams","get","_this","pluginFactories","playground","factory","plugins","ready","Promise","resolve","initialize","prototype","extend","name","plugin","undefined","Error","plug","configuration","e_1","_a","_b","_c","_d","_e","instance","logger_1","getLogger","info","detectedAppId","configuredAppId","appId","test","sdkConfiguration","__rest","sdk","SdkFacade","init","__assign","process","env","CROCT_TEST_MODE","NODE_ENV","logger","warn","pending","_loop_1","name_1","options","debug","this_1","error","describe","args","version","VERSION","tracker","evaluator","user","session","tab","context","getTab","tokenStore","getToken","bind","setToken","cidAssigner","eventManager","namespace","_i","arguments","length","apply","__spreadArray","__read","getTabStorage","getBrowserStorage","formatCause","promise","enable","push","then","catch","_f","__values","entries","_g","next","done","_h","e_1_1","return","call","initializeEap","croctEap","all","enumerable","configurable","flushed","isAnonymous","getUserId","getUser","identify","userId","anonymize","token","Token","parse","unsetToken","track","type","payload","evaluate","expression","result","fetch","slotId","eap","unplug","__awaiter","_loop_2","pluginName","controller","e_2","__generator","label","disable","e_2_1","sent","trys","close","feature","method"],"sources":["C:/Users/User/croct/node_modules/@croct/plug/plug.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GlobalPlug = void 0;\nvar tslib_1 = require(\"tslib\");\nvar sdkFacade_1 = require(\"@croct/sdk/facade/sdkFacade\");\nvar error_1 = require(\"@croct/sdk/error\");\nvar validation_1 = require(\"@croct/sdk/validation\");\nvar token_1 = require(\"@croct/sdk/token\");\nvar sdk_1 = require(\"@croct/sdk\");\nvar constants_1 = require(\"./constants\");\nvar playground_1 = require(\"./playground\");\nvar PLUGIN_NAMESPACE = 'Plugin';\nfunction detectAppId() {\n    var script = window.document.querySelector(\"script[src^='\" + constants_1.CDN_URL + \"']\");\n    if (!(script instanceof HTMLScriptElement)) {\n        return null;\n    }\n    return (new URL(script.src)).searchParams.get('appId');\n}\nvar GlobalPlug = /** @class */ (function () {\n    function GlobalPlug() {\n        var _this = this;\n        this.pluginFactories = { playground: playground_1.factory };\n        this.plugins = {};\n        this.ready = new Promise(function (resolve) {\n            _this.initialize = resolve;\n        });\n    }\n    GlobalPlug.prototype.extend = function (name, plugin) {\n        if (this.pluginFactories[name] !== undefined) {\n            throw new Error(\"Another plugin is already registered with name \\\"\" + name + \"\\\".\");\n        }\n        this.pluginFactories[name] = plugin;\n    };\n    GlobalPlug.prototype.plug = function (configuration) {\n        var e_1, _a;\n        var _this = this;\n        var _b, _c, _d, _e;\n        if (configuration === void 0) { configuration = {}; }\n        if (this.instance !== undefined) {\n            var logger_1 = this.instance.getLogger();\n            logger_1.info('Croct is already plugged in.');\n            return;\n        }\n        var detectedAppId = detectAppId();\n        var configuredAppId = (_b = configuration.appId) !== null && _b !== void 0 ? _b : null;\n        if (detectedAppId !== null && configuredAppId !== null && detectedAppId !== configuredAppId) {\n            throw new Error('The specified app ID and the auto-detected app ID are conflicting. '\n                + 'There is no need to specify an app ID when using an application-specific tag. '\n                + 'Please try again omitting the \"appId\" option.');\n        }\n        var appId = detectedAppId !== null && detectedAppId !== void 0 ? detectedAppId : configuredAppId;\n        if (appId === null) {\n            throw new Error('The app ID must be specified when it cannot be auto-detected. '\n                + 'Please try again specifying the \"appId\" option.');\n        }\n        var plugins = configuration.plugins, test = configuration.test, sdkConfiguration = tslib_1.__rest(configuration, [\"plugins\", \"test\"]);\n        var sdk = sdkFacade_1.SdkFacade.init(tslib_1.__assign(tslib_1.__assign({}, sdkConfiguration), { appId: appId, test: test !== null && test !== void 0 ? test : (typeof process === 'object' && (((_c = process.env) === null || _c === void 0 ? void 0 : _c.CROCT_TEST_MODE) !== undefined\n                ? process.env.CROCT_TEST_MODE === 'true'\n                : ((_d = process.env) === null || _d === void 0 ? void 0 : _d.NODE_ENV) === 'test')) }));\n        this.instance = sdk;\n        var logger = this.instance.getLogger();\n        if (detectedAppId === configuredAppId) {\n            logger.warn('It is strongly recommended omitting the \"appId\" option when using '\n                + 'the application-specific tag as it is detected automatically.');\n        }\n        var pending = [];\n        var _loop_1 = function (name_1, options) {\n            logger.debug(\"Initializing plugin \\\"\" + name_1 + \"\\\"...\");\n            var factory = this_1.pluginFactories[name_1];\n            if (factory === undefined) {\n                logger.error(\"Plugin \\\"\" + name_1 + \"\\\" is not registered.\");\n                return \"continue\";\n            }\n            if (typeof options !== 'boolean' && (options === null || typeof options !== 'object')) {\n                logger.error(\"Invalid options for plugin \\\"\" + name_1 + \"\\\", \"\n                    + (\"expected either boolean or object but got \" + validation_1.describe(options)));\n                return \"continue\";\n            }\n            if (options === false) {\n                logger.warn(\"Plugin \\\"\" + name_1 + \"\\\" is declared but not enabled\");\n                return \"continue\";\n            }\n            var args = {\n                options: options === true ? {} : options,\n                sdk: {\n                    version: sdk_1.VERSION,\n                    appId: appId,\n                    tracker: sdk.tracker,\n                    evaluator: sdk.evaluator,\n                    user: sdk.user,\n                    session: sdk.session,\n                    tab: sdk.context.getTab(),\n                    tokenStore: {\n                        getToken: sdk.getToken.bind(sdk),\n                        setToken: sdk.setToken.bind(sdk),\n                    },\n                    cidAssigner: sdk.cidAssigner,\n                    eventManager: sdk.eventManager,\n                    getLogger: function () {\n                        var namespace = [];\n                        for (var _i = 0; _i < arguments.length; _i++) {\n                            namespace[_i] = arguments[_i];\n                        }\n                        return sdk.getLogger.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n                    },\n                    getTabStorage: function () {\n                        var namespace = [];\n                        for (var _i = 0; _i < arguments.length; _i++) {\n                            namespace[_i] = arguments[_i];\n                        }\n                        return sdk.getTabStorage.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n                    },\n                    getBrowserStorage: function () {\n                        var namespace = [];\n                        for (var _i = 0; _i < arguments.length; _i++) {\n                            namespace[_i] = arguments[_i];\n                        }\n                        return sdk.getBrowserStorage.apply(sdk, tslib_1.__spreadArray([PLUGIN_NAMESPACE, name_1], tslib_1.__read(namespace)));\n                    },\n                },\n            };\n            var plugin = void 0;\n            try {\n                plugin = factory(args);\n            }\n            catch (error) {\n                logger.error(\"Failed to initialize plugin \\\"\" + name_1 + \"\\\": \" + error_1.formatCause(error));\n                return \"continue\";\n            }\n            logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" initialized\");\n            if (typeof plugin !== 'object') {\n                return \"continue\";\n            }\n            this_1.plugins[name_1] = plugin;\n            var promise = plugin.enable();\n            if (!(promise instanceof Promise)) {\n                logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" enabled\");\n                return \"continue\";\n            }\n            pending.push(promise\n                .then(function () { return logger.debug(\"Plugin \\\"\" + name_1 + \"\\\" enabled\"); })\n                .catch(function (error) { return logger.error(\"Failed to enable plugin \\\"\" + name_1 + \"\\\": \" + error_1.formatCause(error)); }));\n        };\n        var this_1 = this;\n        try {\n            for (var _f = tslib_1.__values(Object.entries(tslib_1.__assign({ playground: true }, plugins))), _g = _f.next(); !_g.done; _g = _f.next()) {\n                var _h = tslib_1.__read(_g.value, 2), name_1 = _h[0], options = _h[1];\n                _loop_1(name_1, options);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        var initializeEap = (_e = window.croctEap) === null || _e === void 0 ? void 0 : _e.initialize;\n        if (typeof initializeEap === 'function') {\n            initializeEap.call(this);\n        }\n        Promise.all(pending).then(function () {\n            _this.initialize();\n            logger.debug('Initialization complete');\n        });\n    };\n    Object.defineProperty(GlobalPlug.prototype, \"initialized\", {\n        get: function () {\n            return this.instance !== undefined;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"plugged\", {\n        get: function () {\n            var _this = this;\n            return this.ready.then(function () { return _this; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"flushed\", {\n        get: function () {\n            var _this = this;\n            return this.tracker.flushed.then(function () { return _this; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"sdk\", {\n        get: function () {\n            if (this.instance === undefined) {\n                throw new Error('Croct is not plugged in.');\n            }\n            return this.instance;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"tracker\", {\n        get: function () {\n            return this.sdk.tracker;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"evaluator\", {\n        get: function () {\n            return this.sdk.evaluator;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"user\", {\n        get: function () {\n            return this.sdk.user;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(GlobalPlug.prototype, \"session\", {\n        get: function () {\n            return this.sdk.session;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    GlobalPlug.prototype.isAnonymous = function () {\n        return this.sdk.context.isAnonymous();\n    };\n    GlobalPlug.prototype.getUserId = function () {\n        return this.sdk.context.getUser();\n    };\n    GlobalPlug.prototype.identify = function (userId) {\n        if (typeof userId !== 'string') {\n            throw new Error('The user ID must be a string. Read more on https://croct.help/plug-js/id-conversion');\n        }\n        this.sdk.identify(userId);\n    };\n    GlobalPlug.prototype.anonymize = function () {\n        this.sdk.anonymize();\n    };\n    GlobalPlug.prototype.setToken = function (token) {\n        this.sdk.setToken(token_1.Token.parse(token));\n    };\n    GlobalPlug.prototype.unsetToken = function () {\n        this.sdk.unsetToken();\n    };\n    GlobalPlug.prototype.track = function (type, payload) {\n        return this.sdk.tracker.track(type, payload);\n    };\n    GlobalPlug.prototype.evaluate = function (expression, options) {\n        if (options === void 0) { options = {}; }\n        return this.sdk.evaluator.evaluate(expression, options);\n    };\n    GlobalPlug.prototype.test = function (expression, options) {\n        if (options === void 0) { options = {}; }\n        return this.evaluate(expression, options)\n            .then(function (result) { return result === true; });\n    };\n    /**\n     * This API is unstable and subject to change in future releases.\n     */\n    GlobalPlug.prototype.fetch = function (slotId, options) {\n        if (options === void 0) { options = {}; }\n        return this.eap('fetch').call(this, slotId, options);\n    };\n    GlobalPlug.prototype.unplug = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, instance, plugins, logger, pending, _loop_2, _b, _c, _d, pluginName, controller;\n            var e_2, _e;\n            var _this = this;\n            return tslib_1.__generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        if (this.instance === undefined) {\n                            return [2 /*return*/];\n                        }\n                        _a = this, instance = _a.instance, plugins = _a.plugins;\n                        logger = this.sdk.getLogger();\n                        pending = [];\n                        _loop_2 = function (pluginName, controller) {\n                            if (typeof controller.disable !== 'function') {\n                                return \"continue\";\n                            }\n                            logger.debug(\"Disabling plugin \\\"\" + pluginName + \"\\\"...\");\n                            var promise = controller.disable();\n                            if (!(promise instanceof Promise)) {\n                                logger.debug(\"Plugin \\\"\" + pluginName + \"\\\" disabled\");\n                                return \"continue\";\n                            }\n                            pending.push(promise\n                                .then(function () { return logger.debug(\"Plugin \\\"\" + pluginName + \"\\\" disabled\"); })\n                                .catch(function (error) { return logger.error(\"Failed to disable \\\"\" + pluginName + \"\\\": \" + error_1.formatCause(error)); }));\n                        };\n                        try {\n                            for (_b = tslib_1.__values(Object.entries(plugins)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                                _d = tslib_1.__read(_c.value, 2), pluginName = _d[0], controller = _d[1];\n                                _loop_2(pluginName, controller);\n                            }\n                        }\n                        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                        finally {\n                            try {\n                                if (_c && !_c.done && (_e = _b.return)) _e.call(_b);\n                            }\n                            finally { if (e_2) throw e_2.error; }\n                        }\n                        // Reset\n                        delete this.instance;\n                        this.plugins = {};\n                        this.ready = new Promise(function (resolve) {\n                            _this.initialize = resolve;\n                        });\n                        return [4 /*yield*/, Promise.all(pending)];\n                    case 1:\n                        _f.sent();\n                        _f.label = 2;\n                    case 2:\n                        _f.trys.push([2, , 4, 5]);\n                        return [4 /*yield*/, instance.close()];\n                    case 3:\n                        _f.sent();\n                        return [3 /*break*/, 5];\n                    case 4:\n                        logger.info('ðŸ”Œ Croct has been unplugged.');\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GlobalPlug.prototype.eap = function (feature) {\n        var logger = this.sdk.getLogger();\n        var eap = window.croctEap;\n        var method = typeof eap === 'object' ? eap[feature] : undefined;\n        if (typeof method !== 'function') {\n            throw new Error(\"The \" + feature + \" feature is currently available only to accounts participating in our \"\n                + 'Early-Access Program (EAP). Please contact your Customer Success Manager or email eap@croct.com '\n                + 'to check your account eligibility.');\n        }\n        logger.warn(\"The \" + feature + \" API is still unstable and subject to change in future releases.\");\n        return method;\n    };\n    return GlobalPlug;\n}());\nexports.GlobalPlug = GlobalPlug;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}